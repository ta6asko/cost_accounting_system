{"version":3,"sources":["../src/reducer.js"],"names":[],"mappings":"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","file":"reducer.js","sourcesContent":["import sortedObject from './sortedObject';\nimport Constants from './Constants';\nimport shallowEqual from 'fbjs/lib/shallowEqual';\nimport {parse, stringify} from 'qs';\nimport {parseRoute, defaultRoute} from './pathname/parse';\nimport {matchRoute} from './pathname/match';\n\n\nexport const initialState = {\n  pathname: '/',\n  hash: '',\n  query: {},\n  cleanQuery: {},\n  defaultParams: {},\n  routes: {},\n  currentRoute: defaultRoute,\n  locationType: Constants.LOCATION_HISTORY\n};\n\nexport const cleanupQuery = ({query, defaultParams}) =>\n  sortedObject(Object.keys(query)\n    .reduce((clean, key) => {\n      if (defaultParams.hasOwnProperty(key) && query[key] === defaultParams[key]) {\n        return clean;\n      }\n      return {...clean, [key]: query[key]};\n    }, {}));\n\n\nexport const safeQuery = (query = {}) => {\n  const newQuery = query === null ? {} : query;\n\n  Object.keys(newQuery).forEach(key => {\n    newQuery[key] = `${newQuery[key]}`;\n  });\n\n  return newQuery;\n};\n\n\nexport const changeParams = (state, params) => {\n  const {defaultParams, query, pathname} = state;\n  const newQuery = sortedObject({...defaultParams, ...query, ...safeQuery(params.query)});\n  const newPathname = params.pathname || pathname;\n\n  if (shallowEqual(newQuery, query) && newPathname === pathname) {\n    return state;\n  }\n\n  const cleanQuery = cleanupQuery({query: newQuery, defaultParams});\n  const currentRoute = matchRoute(state.routes, defaultRoute)(newPathname);\n\n  return {\n    ...state,\n    query: newQuery,\n    pathname: newPathname,\n    cleanQuery,\n    currentRoute\n  };\n};\n\n\nexport const addDefaultParam = (state, {namespace, value}) => {\n  const {defaultParams, query} = state;\n  const stringValue = `${value}`;\n\n  if (defaultParams.hasOwnProperty(namespace) && defaultParams[namespace] === stringValue) {\n    return state;\n  }\n\n  const newDefaultParams = {...defaultParams, [namespace]: stringValue};\n  const newQuery = sortedObject({...newDefaultParams, ...query});\n\n  return {\n    ...state,\n    defaultParams: newDefaultParams,\n    query: newQuery,\n    cleanQuery: cleanupQuery({query: newQuery, defaultParams: newDefaultParams})\n  };\n};\n\n\nexport const removeParam = (state, {namespace}) => {\n  const {defaultParams, query} = state;\n  const newDefaultParams = {...defaultParams};\n  const newQuery = sortedObject({...defaultParams, ...query});\n\n  if (newDefaultParams.hasOwnProperty(namespace)) {\n    delete newDefaultParams[namespace];\n  }\n  if (newQuery.hasOwnProperty(namespace)) {\n    delete newQuery[namespace];\n  }\n\n  return {\n    ...state,\n    defaultParams: newDefaultParams,\n    query: newQuery,\n    cleanQuery: cleanupQuery({query: newQuery, defaultParams: newDefaultParams})\n  };\n};\n\n\nexport const restoreLocation = (state, {location, locationType = Constants.LOCATION_HISTORY}) => {\n  const {defaultParams} = state;\n  const {pathname, search, hash} = location;\n\n  const newQuery = sortedObject({\n    ...defaultParams,\n    ...safeQuery(parse(search.substr(1), {strictNullHandling: true}))\n  });\n\n  return {\n    ...state,\n    pathname,\n    hash,\n    query: newQuery,\n    cleanQuery: cleanupQuery({query: newQuery, defaultParams}),\n    currentRoute: matchRoute(state.routes, defaultRoute)(pathname),\n    locationType\n  };\n};\n\n\nexport const addRoute = (state, payload) => {\n  const routes = {...state.routes, [payload.route]: parseRoute(payload.route)};\n  const currentRoute = matchRoute(routes, defaultRoute)(state.pathname);\n\n  return {...state, routes, currentRoute};\n};\n\n\nexport const removeRoute = (state, payload) => ({\n  ...state,\n  routes: Object.keys(state.routes)\n    .filter(key => key !== payload.route)\n    .reduce((result, key) => ({...result, [key]: state.routes[key]}), {})\n});\n\n\nexport const href = (state, payload) => {\n  const {pathname, cleanQuery, hash} = changeParams(state, payload);\n  const search = stringify(cleanQuery, {strictNullHandling: true});\n\n  return [pathname, search.length > 0 ? `?${search}` : '', hash].join('');\n};\n\n\nexport const isActive = (state, {pathname, query}) => {\n  const {\n    pathname: newPathname, cleanQuery\n  } = changeParams(state, {pathname, query});\n\n\n  return shallowEqual(cleanQuery, state.cleanQuery) &&\n    newPathname === state.pathname;\n};\n\n\nconst reduce = (state, {type, payload}) => {\n  switch (type) {\n    case Constants.NAVIGATE_TO:\n      return changeParams(state, payload);\n\n    case Constants.ADD_DEFAULT_PARAM:\n      return addDefaultParam(state, payload);\n\n    case Constants.REMOVE_PARAM:\n      return removeParam(state, payload);\n\n    case Constants.RESTORE_LOCATION:\n      return restoreLocation(state, payload);\n\n    case Constants.ADD_ROUTE:\n      return addRoute(state, payload);\n\n    case Constants.REMOVE_ROUTE:\n      return removeRoute(state, payload);\n\n    default:\n      return state;\n  }\n};\n\n\nexport const componentRouter = (state = initialState, {type, payload}) => {\n  const newState = reduce(state, {type, payload});\n\n  return shallowEqual(state, newState) ? state : newState;\n};\n"]}